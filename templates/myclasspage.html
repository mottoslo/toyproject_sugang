<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <link href="https://fonts.googleapis.com/css2?family=Gowun+Batang:wght@400;700&display=swap" rel="stylesheet" />
    <title>Document</title>
    <link rel="stylesheet" href="../static/css/menu.css" />
    <link rel="stylesheet" href="../static/css/myclasspage.css" />
</head>
<script>
    $(document).ready(function () {
        // 로그인 세션 확인

        // 신청강의 리스트
        enroll_list();
    });
    //user_id 얻기
    let user_id = "aaa";
    function enroll_list() {
        let formData = new FormData();
        // user_id 넘기기
        formData.append("user_id", user_id);
        fetch("/api/enroll_list", { method: "POST", body: formData })
            .then((res) => res.json())
            .then((data) => {
                let rows = data["result"];
                $("#myclass").empty();
                rows.forEach((a) => {
                    // 변수에 app.py에서 받아온 값 삽입
                    let class_code = a["class_code"];
                    let class_name = a["class_name"];
                    let instructor = a["instructor"];
                    let class_day = a["class_time"]["day"];
                    let class_stime = a["class_time"]["start_time"];
                    let class_etime = a["class_time"]["end_time"];
                    let class_max = a["class_max"];
                    let class_now = a["class_now"];

                    let class_time = class_stime.substr(0, 2) + ":" + class_stime.substr(2, 2) + "-" + class_etime.substr(0, 2) + ":" + class_etime.substr(2, 2);

                    // tr로 붙일 html 생성
                    temp_html = `<tr>
                        <td><input type="checkbox" id="${class_code}" name="chkbox"></td>
                        <td>${class_code}</td>
                        <td><a href="#">${class_name}</a></td>
                        <td>${instructor}</td>
                        <td>${class_day}</td>
                        <td>${class_time}</td>
                        <td>${class_now}/${class_max}</td>
                    </tr>`;
                    $("#myclass").append(temp_html);
                });
            });
    }

    function class_cancel() {
        let cnt = $("input[name='chkbox']:checked").length;
        let chklist = [];
        $("input[name='chkbox']:checked").each(function () {
            chklist.push($(this).attr("id"));
        });
        if (cnt === 0) {
            alert("선택된 강의가 없습니다.");
        } else {
            console.log(chklist);

            let formData = new FormData();
            // user_id, chklist 넘기기
            formData.append("user_id", user_id);
            formData.append("chklist", chklist);
            fetch("/api/enroll_delete", { method: "POST", body: formData })
                .then((res) => res.json())
                .then((data) => {
                    alert("취소 되었습니다.")
                    window.location.reload()
                });
        }
    }
</script>
<body>
    <!-- 내 신청내역 보여주고, 삭제, 신청버튼, 시간표들어갈 공간 남겨두기 -->
    <div class="logo-home"></div>
    <div class="info-bar"></div>
    <div class="bar-and-content">
        <div class="side-bar">
            <li><a href="#">수강신청 안내</a></li>
            <li><a href="#">강의목록</a></li>
            <li><a href="#">수강희망과목</a></li>
            <li><a href="#">신청내역</a></li>
        </div>
        <div class="content-area">
            <div class="timetable">시간표 영역</div>
            <h2>내 신청내역</h2>
            <table class="enroll_list">
                <thead>
                    <th>체크</th>
                    <th>과목코드</th>
                    <th>수업명</th>
                    <th>강사명</th>
                    <th>강의요일</th>
                    <th>강의시간</th>
                    <th>현재/최대</th>
                </thead>
                <tbody id="myclass">
                    <!-- <tr>
                <td><input type="checkbox"></td>
                <td>CC101</td>
                <td><a href="#">웹개발종합반</a></td>
                <td>이범규 튜터</td>
                <td>Mon</td>
                <td>09:00-10:30</td>
                <td>127/300</td>
                <td><button>수강취소</button></td>
            </tr>
            <tr>
                <td><input type="checkbox"></td>
                <td>RC101</td>
                <td><a href="#">자바스크립트 문법뽀개기</a></td>
                <td>김신록 튜터</td>
                <td>Fri</td>
                <td>15:30-17:00</td>
                <td>15/100</td>
                <td><button>수강취소</button></td>
            </tr>
            <tr>
                <td><input type="checkbox"></td>
                <td>RC101</td>
                <td><a href="#">웹퍼블리싱 정복반</a></td>
                <td>임흥선 튜터</td>
                <td>Wed</td>
                <td>15:30-17:00</td>
                <td>88/150</td>
                <td><button>수강취소</button></td>
            </tr> -->
                </tbody>
            </table>
            <div class="btn">
                <!-- <button id="addbtn">데이터삽입</button> -->
                <button id="ccbtn" onclick="class_cancel()" type="button">수강취소</button>
            </div>
        </div>
    </div>
</body>
</html>
